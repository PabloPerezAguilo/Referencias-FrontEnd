
<form name="useForm" >
    <h1 class="cabeceraPagina">{{titulo}}</h1>
    <md-content class="layout-padding">
        <div class="para1">
            
            <!--CLIENTE-->
            <div class="control-group" ng-class="{true: 'error'}[submitted && form.email.$invalid]">
                  <md-dialog-content class="selecCli">
                    <div class="md-dialog-content">
                      <form ng-submit="$event.preventDefault()">
                        <label class="txtSimilarMD">Cliente *</label>
                        <md-autocomplete flex required
                            pattern="[a-zA-Z]+"
                            md-selected-item="ctrl.selectedItem"
                            md-search-text="ctrl.searchText" 
                            md-items="item in ctrl.querySearch(ctrl.searchText) | filter : cliente | limitTo : 8"
                            md-selected-item-change="ctrl.selectedItemChange(item)"
                            md-item-text="item.display"
                            md-min-length="3"
                            ng-model="referencia.cliente"
                            name="cliente"
                            ng-disabled="deshabilitarForm===true"
                            placeholder="Busque por cliente o siglas."
                            ng-required
                            ng-init="ctrl.searchText=clienteCargado"
                            tabindex="1">
                          <md-item-template>
                            <span md-highlight-text="ctrl.searchText" md-highlight-flags="^i">{{item.display}}</span>
                          </md-item-template>
                          <md-not-found>
                            No se encuenta "{{ctrl.searchText}}" en la lista.
                          </md-not-found>            
                        </md-autocomplete>
                      </form>
                    </div> 
                  </md-dialog-content>
            </div>          
            <br>     
            <!--    SOCIEDAD-->
            <md-input-container title="Sociedad" class="fixed-size" id="sociedad">
                <label>Sociedad *</label>
                <md-select name="sociedad"
                           tabindex="2"
                           ng-model="referencia.sociedad"
                           ng-required="true"
                           ng-disabled="deshabilitarForm===true"
                           id="sociedad"  
                           ng-blur="actualizaErrores('sociedad', useForm.sociedad.$error)">

                    <md-option ng-value="sociedad.codigo" data-ng-repeat="sociedad in catalogo.sociedades" ng-selected="sociedad.codigo == referencia.sociedadSeleccionado ? true:false" >
                        {{sociedad.descripcion}} ({{ sociedad.codigo }})
                    </md-option>
                </md-select>
            </md-input-container>

            <!--   SECTOR-->
            <md-input-container title="Sector Empresarial" class="fixed-size" id="sectorEmpresarial">
                <label>Sector Empresarial *</label>
                <md-select name="SectorEmp"
                           ng-model="referencia.sectorEmpresarial"  
                           ng-required="true" 
                           ng-disabled="deshabilitarForm===true" 
                           tabindex="3"
                           ng-blur="actualizaErrores('SectorEmp', useForm.SectorEmp.$error)">
                    <md-option ng-value="sectorEmpresarial.codigo" data-ng-repeat="sectorEmpresarial in catalogo.sectorempresarial" ng-selected="sectorEmpresarial.codigo == referencia.sectorEmpresarialSeleccionado ? true:false">
                        {{sectorEmpresarial.descripcion}}  ({{ sectorEmpresarial.codigo }})
                    </md-option>
              </md-select>
            </md-input-container>

            <!--    Tipo de actividad-->
            <md-input-container title="Tipo de actividad" class="fixed-size" id="actividad">
                <label>Tipo de actividad *</label>
                <md-select
                           name="tActividad"
                           ng-model="referencia.tipoActividad"
                           ng-required="true"
                           ng-disabled="deshabilitarForm===true"
                           tabindex="4"
                           ng-blur="actualizaErrores('tActividad', useForm.tActividad.$error)">
                    <md-option ng-value="tipoActividad.codigo" data-ng-repeat="tipoActividad in catalogo.actividad" ng-selected="tipoActividad.codigo == referencia.tipoActividadSeleccionado ? true:false">
                    {{ tipoActividad.descripcion }} ({{ tipoActividad.codigo }})
                    </md-option>      
                </md-select>
            </md-input-container>

            <!--    Tipo de proyecto-->
            <md-input-container title="Tipo de proyecto" class="fixed-size" id="tipoProyecto">
                <label>Tipo de proyecto *</label>
                <md-select
                           name="tProyecto"
                           ng-model="referencia.tipoProyecto"
                           ng-required="true"
                           ng-disabled="deshabilitarForm===true"
                           tabindex="5"
                           ng-blur="actualizaErrores('tProyecto', useForm.tProyecto.$error)">
                    <md-option ng-value="tipoProyecto.codigo" data-ng-repeat="tipoProyecto in catalogo.proyecto" ng-selected="tipoProyecto.codigo == referencia.tipoProyectoSeleccionado ? true:false">
                    {{ tipoProyecto.descripcion }} ({{ tipoProyecto.codigo }})
                    </md-option>      
                </md-select>
            </md-input-container>

            <!--Fecha inicio, Usa la libreria Moment.js-->
            
            <md-datepicker id="fecha" ng-model="fechaInicio" md-placeholder="Fecha de Inicio *"></md-datepicker>
            
            <!--    Duración-->         
            <md-input-container title="Duración en meses" class="fixed-size" id="Duracion">
                <label>Duración en meses *</label>
                <input name="duracion" type="number" min="1" ng-model="referencia.duracionMeses" ng-disabled="deshabilitarForm===true" ng-required="true"tabindex="7" ng-blur="actualizaErrores('duracion', useForm.duracion.$error)"/>

            </md-input-container>

            <!-- Denominación-->
            <md-input-container title="Denominación" class="fixed-size-denominacion" ng-disabled="mostrarBtValidar===true" id="denominacion">
                <label>Denominación *</label>
                <textarea name="denominacion"
                          type="text"
                          ng-model="referencia.denominacion"
                          ng-disabled="deshabilitarForm===true" 
                          max="100"
                          md-maxlength="100"
                          rows="2"
                          ng-required="true"tabindex="8"
                          ng-blur="actualizaErrores('denominacion', useForm.denominacion.$error)">
                </textarea>
            </md-input-container>

            <!-- Resumen del proyecto-->
            <div id="cajon1">
                <md-input-container title="Resumen del proyecto" class="fixed-size-resumen" id="Resumen">
                    <label>Resumen proyecto *</label>
                    <textarea name="Rproyecto"
                              ng-model="referencia.resumenProyecto"
                              ng-disabled="deshabilitarForm===true"
                              max="300"
                              md-maxlength="300"
                              rows="5"
                              ng-required="true"
                              tabindex="9"
                              ng-blur="actualizaErrores('Rproyecto', useForm.Rproyecto.$error)">
                    </textarea>
                </md-input-container>
            </div>
            <!--Problemática del cliente-->
            <div id="cajon2">
            <md-input-container title="Problemática del cliente" class="fixed-size-resumen" id="Problematica">
                <label>Problemática del cliente *</label>
                <textarea name="ProblemaCliente"
                          ng-model="referencia.problematicaCliente"
                          ng-disabled="deshabilitarForm===true"
                          max="300"
                          md-maxlength="300"
                          rows="5"
                          ng-required="true"
                          tabindex="10"
                          ng-blur="actualizaErrores('ProblemaCliente', useForm.ProblemaCliente.$error)">
                </textarea>
            </md-input-container>
            </div>

            <!--    Solución-->
            <md-input-container title="Solución GFI" class="fixed-size-solucion" id="solucion">
                <label>Solución GFI *</label>
                <textarea name="solGFI"
                          type="text"
                          ng-model="referencia.solucionGfi"
                          ng-disabled="deshabilitarForm===true"
                          max="500"
                          md-maxlength="500"
                          rows="6"
                          ng-required="true"
                          tabindex="11"
                          ng-blur="actualizaErrores('solGFI', useForm.solGFI.$error)">
                </textarea>
            </md-input-container>

            <!--    FTE totales-->       
            <md-input-container title="FTE Totales" class="fixed-size" id="fte">
                <label>FTE Totales *</label>
                <input name="fteTotal"
                       type="number"
                       min="1"
                       ng-model="referencia.fteTotales"
                       ng-disabled="deshabilitarForm===true"
                       ng-required="true"
                       tabindex="12"
                       ng-blur="actualizaErrores('fteTotal', useForm.fteTotal.$error)"/>
            </md-input-container>

            <!--    Certificado-->
            <md-input-container title="Existe certificado del cliente" class="fixed-size">
                <md-radio-group name="certificado"
                                ng-model="referencia.certificado"
                                ng-disabled="deshabilitarForm===true"
                                ng-required="true"
                                tabindex="13"
                                ng-blur="actualizaErrores('certificado', useForm.certificado.$error)">                  

                <label>¿Existe certificado del cliente? *</label><br>
                    <md-radio-button style="margin-bottom: -35px" value="si" ng-checked="true" ng-disabled="deshabilitarForm===true">Si</md-radio-button>
                    <md-radio-button style="margin-left: 80px" value="no" ng-disabled="deshabilitarForm===true">No</md-radio-button>
                </md-radio-group>
            </md-input-container>

            <!--Registros-->
            <md-input-container title="Registros de pedido asociados a la referencia" class="fixed-size">
                <label>Registros de pedido asociados a la referencia *</label>
                <input name="registroPedido" type="text" ng-disabled="deshabilitarForm===true" ng-model="referencia.regPedidoAsociadoReferencia" tabindex="14"/> <!--ng-required="true"-->
            </md-input-container>

            <!--Responsables-->
            <div layout="row">
                <!--Responsable comercial-->
                <md-input-container title="Responsable comercial" class="contCom" id="comercial">
                    <label>Responsable Comercial *</label>

                    <md-select name="rbleComercial"
                               ng-model="referencia.responsableComercial"
                               ng-disabled="deshabilitarForm===true"
                               required
                               tabindex="15"
                               ng-blur="actualizaErrores('rbleComercial', useForm.rbleComercial.$error)"> 

                        <md-option ng-value="responsableComercial.nombre" data-ng-repeat="responsableComercial in catalogo.comercial" ng-selected="responsableComercial.nombre == referencia.responsableComercialSeleccionado ? true:false">
                            {{ responsableComercial.nombre }} ({{ responsableComercial.login }})
                        </md-option>
                    </md-select>
                </md-input-container> 

                <!--    Responsable Técnico--> 
                <md-input-container title="Responsable técnico" class="contTec" id="Tecnico">
                    <label>Responsable Técnico *</label>
                    <md-select name="rbleTecnico"
                               ng-model="referencia.responsableTecnico"
                               ng-disabled="deshabilitarForm===true"
                               required
                               tabindex="16"
                               ng-blur="actualizaErrores('rbleTecnico', useForm.rbleTecnico.$error)">
                        <md-option ng-value="responsableTecnico.nombre" data-ng-repeat="responsableTecnico in catalogo.tecnico" ng-selected="responsableTecnico.nombre == referencia.responsableTecnicoSeleccionado ? true:false">
                            {{ responsableTecnico.nombre }} ({{ responsableTecnico.login }})
                        </md-option>
                    </md-select>
                </md-input-container>
            </div>

            <!--    Código QR e imagen-->                  
            <div layout="row" class="ImgQr">          
                <div class="contQr">
                    <!--Imagen-->
                    <input type="file"
                           name="userfile"
                           style="display:none;"
                           ng-model="referencia.imagenProyecto"
                           id="botonFileReal"
                           onchange="angular.element(this).scope().uploadFile(this)"
                           ng-disabled="deshabilitarForm===true"
                           ng-required>
                    <input type="button"
                           class="botones"
                           value="SUBIR IMAGEN *"
                           onclick="document.getElementById('botonFileReal').click();"
                           style=""
                           ng-disabled="deshabilitarForm===true"
                           tabindex="17"
                           ng-blur="actualizaErrores('userfile', useForm.userfile.$error)"/>
                    
                    <br><br><br><br>
                    <!--Código QR--> 
                    <md-input-container title="Código QR" class="fixed-size">
                        <label>Código Qr</label>
                        <input ng-model="referencia.codigoQr" ng-Change="QrChaged()" ng-disabled="deshabilitarForm===true" tabindex="18"/>
                    </md-input-container>
                    <br>
                    <div class="centrado-QR">
                        <qr ng-init="qrCodeVisible=valorQr" text="codigoQr" version="3" error-correction-level="Q" size="100" ng-show="qrCodeVisible"></qr>
                    </div>   
                </div> 
                <!--Imagen-->  
                <div layout="row" class="contImg">           
                    <img ng-src="data:image/jpeg;base64,{{UserPhoto}}" id="photo-id" width="450" height="450"/>          
                </div>
            </div>
            <br>
                
            <div class="contenedor-tecnologia">
                <md-dialog-content class="selecTec" id="tecnologia">
                    <div class="md-dialog-content">
                        <form ng-submit="$event.preventDefault()">
                            <label class="txtSimilarMD">Tecnología *</label>
                            <md-autocomplete pattern="[a-zA-Z ]+"
                                md-selected-item="ctrl.selectedItemt"
                                md-search-text="ctrl.searchTextt"
                                md-items="item2 in ctrl.querySearchT(ctrl.searchTextt) | filter : tecnologia | limitTo : 4"
                                md-selected-item-change="ctrl.selectedItemChangeT(item2)"
                                md-item-text="item2.display"
                                md-min-length="2"
                                ng-model="referencia.tecnologia"
                                name="tecnologia"
                                ng-disabled="deshabilitarForm===true"
                                placeholder="Busque Tecnologías"
                                ng-required
                                ng-init="ctrl.searchTextt=tecnologiaCargada"
                                tabindex="19">
                            <md-item-template>
                                <span md-highlight-text="ctrl.searchTextt" md-highlight-flags="^i">{{item2.display}}</span>
                            </md-item-template>
                            <md-not-found>
                                No se encuenta "{{ctrl.searchTextt}}" en la lista.
                            </md-not-found>            
                            </md-autocomplete>
                      </form>
                    </div>
                </md-dialog-content>
            </div>

            <!--    Resultado de la operación-->
            <p id="mensajeEstado" >{{mensajeEstado}}</p>
                
                
            <button ng-click="ayuda();"  >Demo</button>
            
            <div class="botonesCrear" layout-align="center">
          
             <!-- BOTONES ROL ADMINISTRADOR/MANTENIMIENTO -->
                <md-button ng-show="mostrarBtCrear" class=botonesApp type="button"  ng-click="crearReferencia('borrador', $event)" tabindex="20">Guardar (Borrador)</md-button>
                <md-button ng-show="mostrarBtCrear" class=botonesApp type="button"  ng-click="crearReferencia('pendiente', $event)" tabindex="21">Terminar</md-button>
            <!-- BOTONES ROL VALIDADOR -->
                <md-button ng-show="mostrarBtValidar" class=botonesApp type="button"  ng-click="rechazarReferencia()" tabindex="22">Rechazar</md-button>
                <md-button ng-show="mostrarBtValidar" class=botonesApp type="button"  ng-click="validarReferencia()" tabindex="23">Validar</md-button>
               
            </div> 
        </div>
    </md-content>
</form>
