<form name="useForm" >
    <h1 class="cabeceraPagina">{{titulo}}</h1>
    <md-content class="layout-padding">
        <div class="para1">
            <div class="control-group" ng-class="{true: 'error'}[submitted && form.email.$invalid]">
                  <md-dialog-content class="selecCli">
                    <div class="md-dialog-content">
                      <form ng-submit="$event.preventDefault()">
                        <label class="txtSimilarMD">Cliente</label>
                        <md-autocomplete flex required
                            pattern="[a-zA-Z]+"
                            md-selected-item="ctrl.selectedItem"
                            md-search-text="ctrl.searchText" 
                            md-items="item in ctrl.querySearch(ctrl.searchText) | filter : cliente | limitTo : 8"
                            md-selected-item-change="ctrl.selectedItemChange(item)"
                            md-item-text="item.display"
                            md-min-length="3"
                            ng-model="referencia.cliente"
                            name="cliente"
                            ng-disabled="habilitarForm===true"
                            placeholder="Busque por cliente o siglas."
                            ng-required
                            ng-init="ctrl.searchText=clienteCargado"
                            tabindex="1">
                          <md-item-template>
                            <span md-highlight-text="ctrl.searchText" md-highlight-flags="^i">{{item.display}}</span>
                          </md-item-template>
                          <md-not-found>
                            No se encuenta "{{ctrl.searchText}}" en la lista.
                          </md-not-found>            
                        </md-autocomplete>
                      </form>
                    </div> 
                      <div ng-messages ="useForm.cliente.$valid">         
                         <div ng-message="required"> * </div>
                    </div> 
                  </md-dialog-content>
            </div>
            <br>

            <!--    CLIENTE-->
            <md-input-container title="Sociedad" class="fixed-size">
                <label>Sociedad</label>
                <md-select name="sociedad" tabindex="2" ng-model="referencia.sociedad" ng-required="true" ng-disabled="mostrarBtValidar===true"> <!--ng-click="limpiarCampoNoDisabled('sociedad')"--> 
                    <md-option ng-value="sociedad.codigo" data-ng-repeat="sociedad in catalogo.sociedades" ng-selected="sociedad.codigo == referencia.sociedadSeleccionado ? true:false" >
                        {{sociedad.descripcion}} ({{ sociedad.codigo }})
                    </md-option>
                </md-select>
                <div ng-messages ="useForm.sociedad.$error">         
                         <div ng-message="required"> * </div>
                    </div> 
            </md-input-container>

            <!--   SECTOR-->
            <md-input-container title="Sector Empresarial" class="fixed-size" >
                <label>Sector Empresarial</label>
                <md-select name="SectorEmp" ng-model="referencia.sectorEmpresarial"  ng-required="true" ng-disabled="mostrarBtValidar===true" tabindex="3">
                    <md-option ng-value="sectorEmpresarial.codigo" data-ng-repeat="sectorEmpresarial in catalogo.sectorempresarial" ng-selected="sectorEmpresarial.codigo == referencia.sectorEmpresarialSeleccionado ? true:false">
                        {{sectorEmpresarial.descripcion}}  ({{ sectorEmpresarial.codigo }})
                    </md-option>
              </md-select>
                 <div ng-messages ="useForm.SectorEmp.$error">         
                    <div ng-message="required"> * </div>
                 </div> 
            </md-input-container>

            <!--    Tipo de actividad-->
            <md-input-container title="Tipo de actividad" class="fixed-size">
                <label>Tipo de actividad</label>
                <md-select name="tActividad" ng-model="referencia.tipoActividad" ng-required="true" ng-disabled="mostrarBtValidar===true" tabindex="4">
                    <md-option ng-value="tipoActividad.codigo" data-ng-repeat="tipoActividad in catalogo.actividad" ng-selected="tipoActividad.codigo == referencia.tipoActividadSeleccionado ? true:false">
                    {{ tipoActividad.descripcion }} ({{ tipoActividad.codigo }})
                    </md-option>      
                </md-select>
                 <div ng-messages ="useForm.tActividad.$error">         
                         <div ng-message="required"> * </div>
                    </div> 
            </md-input-container>

            <!--    Tipo de proyecto-->
            <md-input-container title="Tipo de proyecto" class="fixed-size">
                <label>Tipo de proyecto</label>
                <md-select name="tProyecto" ng-model="referencia.tipoProyecto" ng-required="true" ng-disabled="mostrarBtValidar===true" tabindex="5">
                    <md-option ng-value="tipoProyecto.codigo" data-ng-repeat="tipoProyecto in catalogo.proyecto" ng-selected="tipoProyecto.codigo == referencia.tipoProyectoSeleccionado ? true:false">
                    {{ tipoProyecto.descripcion }} ({{ tipoProyecto.codigo }})
                    </md-option>      
                </md-select>
                 <div ng-messages ="useForm.tProyecto.$error">         
                         <div ng-message="required"> * </div>
                    </div> 
            </md-input-container>

            <!--    Fecha inicio-->
            <md-datepicker ng-model="fechaInicio" md-placeholder="Fecha de Inicio" class="ng-untouched ng-valid ng-isolate-scope ng-dirty ng-valid-parse" aria-invalid="false" ng-disabled="mostrarBtValidar===true" ng-required="true" tabindex="6">
                <button class="md-datepicker-button md-icon-button md-button md-ink-ripple" type="button" ng-transclude="" aria-hidden="true" ng-click="ctrl.openCalendarPane($event)">
                    <md-icon class="md-datepicker-calendar-icon ng-scope ng-isolate-scope" md-svg-icon="md-calendar" aria-label="md-calendar" role="img">
                        <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fit="" preserveAspectRatio="xMidYMid meet" style="pointer-events: none; display: block;">
                            <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z">
                            </path>
                        </svg>
                    </md-icon>
                    <div class="md-ripple-container"></div>
                </button>
                <div class="md-datepicker-input-container" ng-class="{'md-datepicker-focused': ctrl.isFocused}">
                    
                    <input name="fecha" class="md-datepicker-input" aria-haspopup="true" ng-focus="ctrl.setFocused(true)" ng-blur="ctrl.setFocused(false)" placeholder="Fecha de Inicio" size="13"/>
                    <button class="md-datepicker-triangle-button md-icon-button md-button" type="button" ng-transclude="" md-no-ink="" ng-click="ctrl.openCalendarPane($event)" aria-label="Open calendar">
                        <div class="md-datepicker-expand-triangle ng-scope"></div>
                    
                        <input ng-model="fechainicio" ng-init="fechainicio='prueba'" class="md-datepicker-input" aria-haspopup="true" ng-focus="ctrl.setFocused(true)" ng-blur="ctrl.setFocused(false)" placeholder="Fecha de Inicio" size="13"/>
                        <button class="md-datepicker-triangle-button md-icon-button md-button" type="button" ng-transclude="" md-no-ink="" ng-click="ctrl.openCalendarPane($event)" aria-label="Open calendar">
                            <div class="md-datepicker-expand-triangle ng-scope">
                        </div>
                    </button>
                </div>
            </md-datepicker>

            <!--    Duración-->         
            <md-input-container title="Duración en meses" class="fixed-size">
                <label>Duración en meses</label>
                <input name="duracion" type="number" min="1" ng-model="referencia.duracionMeses" ng-disabled="mostrarBtValidar===true" ng-required="true"tabindex="7"/>
                 <div ng-messages ="useForm.duracion.$error">         
                    <div ng-message ="required"> * </div>
                </div> 
            </md-input-container>

            <!-- Denominación-->
            <md-input-container title="Denominación" class="fixed-size-denominacion" ng-disabled="mostrarBtValidar===true">
                <label>Denominación</label>
                <textarea name="denominacion" type="text" ng-model="referencia.denominacion" ng-disabled="mostrarBtValidar===true"  max="100" md-maxlength="100" rows="2" ng-required="true"tabindex="8"></textarea>
                <div ng-messages ="useForm.denominacion.$error">         
                        <div ng-message ="required"> * </div>
                </div> 
            </md-input-container>

            <!-- Resumen del proyecto-->
            <div id="cajon1">
                <md-input-container title="Resumen del proyecto" class="fixed-size-resumen">
                    <label>Resumen proyecto</label>
                    <textarea name="Rproyecto" ng-model="referencia.resumenProyecto" ng-disabled="mostrarBtValidar===true" max="300" md-maxlength="300" rows="5" ng-required="true" tabindex="9"></textarea>
                    <div ng-messages="useForm.Rproyecto.$error">         
                        <div ng-message ="required"> * </div>
                    </div> 
                </md-input-container>
            </div>
            <!--Problemática del cliente-->
            <div id="cajon2">
            <md-input-container title="Problemática del cliente" class="fixed-size-resumen">
                <label>Problemática del cliente</label>
                <textarea name="ProblemaCliente" ng-model="referencia.problematicaCliente" ng-disabled="mostrarBtValidar===true" max="300" md-maxlength="300" rows="5" ng-required="true" tabindex="10">
                </textarea>
                <div ng-messages ="useForm.ProblemaCliente.$error">         
                    <div ng-message ="required"> * </div>
                </div>
            </md-input-container>
            </div>

            <!--    Solución-->
            <md-input-container title="Solución GFI" class="fixed-size-solucion">
                <label>Solución GFI</label>
                <textarea type="text" ng-model="referencia.solucionGfi" ng-disabled="mostrarBtValidar===true" max="500" md-maxlength="500" rows="6" ng-required="true" tabindex="11"></textarea>
                <div ng-messages ="useForm.soluciongfi.$error">         
                    <div ng-message ="required"> * </div>
                </div>
            </md-input-container>

            <!--    FTE totales-->       
            <md-input-container title="FTE Totales" class="fixed-size">
                <label>FTE Totales</label>
                <input name="ftetotal" type="number" min="1" ng-model="referencia.fteTotales" ng-disabled="mostrarBtValidar===true" ng-required="true" tabindex="12"/>
                <div ng-messages ="useForm.ftetotal.$error">         
                    <div ng-message ="required"> * </div>
                </div>
            </md-input-container>

            <!--    Certificado-->
            <md-input-container title="Existe certificado del cliente" class="fixed-size">
                <md-radio-group name="certificado" ng-model="referencia.certificado" ng-disabled="mostrarBtValidar===true" ng-required="true" tabindex="13">                  
                <label>¿Existe certificado del cliente?</label><br>
                    <md-radio-button style="margin-bottom: -35px" value="si" ng-checked="true" ng-disabled="habilitarForm===true">Si</md-radio-button>
                    <md-radio-button style="margin-left: 80px" value="no" ng-disabled="habilitarForm===true">No</md-radio-button>
                </md-radio-group>
                <div ng-messages ="useForm.certificado.$error">         
                    <div ng-message ="required"> * </div>
                </div>
            </md-input-container>

            <!--Registros-->
            <md-input-container title="Registros de pedido asociados a la referencia" class="fixed-size">
                <label>Registros de pedido asociados a la referencia</label>
                <input name="registroPedido" type="text" ng-disabled="mostrarBtValidar===true" ng-model="referencia.regPedidoAsociadoReferencia" tabindex="14"/> <!--ng-required="true"-->

                <!--<div ng-messages ="useForm.registroPedido.$error">         
                    <div ng-message ="required"> * </div>
                </div>-->
            </md-input-container>

            <!--    Responsables-->
            <div layout="row">
                <!--Responsable comercial-->
                <md-input-container title="Responsable comercial" class="contCom" >
                    <label>Responsable Comercial</label>

                    <md-select name="rblecomercial" ng-model="referencia.responsableComercial" ng-disabled="mostrarBtValidar===true" required tabindex="15"> 

                        <md-option ng-value="responsableComercial.nombre" data-ng-repeat="responsableComercial in catalogo.comercial" ng-selected="responsableComercial.nombre == referencia.responsableComercialSeleccionado ? true:false">
                            {{ responsableComercial.nombre }} ({{ responsableComercial.login }})
                        </md-option>
                    </md-select>
                    <div ng-messages ="useForm.rblecomercial.$error">         
                        <div ng-message ="required"> * </div>
                    </div>
                </md-input-container> 

                <!--    Responsable Técnico--> 
                <md-input-container title="Responsable técnico" class="contTec" md-on-open="loadOptions()" md-on-close="closeOptions()">
                    <label>Responsable Técnico</label>
                    <md-select name="rbletecnico" ng-model="referencia.responsableTecnico" ng-disabled="mostrarBtValidar===true" required tabindex="16">
                        <md-option ng-value="responsableTecnico.nombre" data-ng-repeat="responsableTecnico in catalogo.tecnico" ng-selected="responsableTecnico.nombre == referencia.responsableTecnicoSeleccionado ? true:false">
                            {{ responsableTecnico.nombre }} ({{ responsableTecnico.login }})
                        </md-option>
                    </md-select>
                    <div ng-messages ="useForm.rbletecnico.$error">         
                    <div ng-message ="required"> * </div>
                </div>
                </md-input-container>
            </div>

            <!--    Código QR e imagen-->                  
            <div layout="row" class="ImgQr">
                <!--Código QR-->      
                <div class="contQr">                         
                        <input type="file" name="userfile" style="display:none;" ng-model="referencia.imagenProyecto" id="botonFileReal" onchange="angular.element(this).scope().uploadFile(this)" ng-disabled="mostrarBtValidar===true" ng-required  >
                        <input type="button" class="botones" value="SUBIR IMAGEN" onclick="document.getElementById('botonFileReal').click();" style="" ng-disabled="mostrarBtValidar===true" tabindex="17">
                    <br><br><br><br>
                    <md-input-container title="Código QR" class="fixed-size">
                        <label>Código Qr</label>
                        <input ng-model="referencia.codigoQr" ng-Change="QrChaged()" ng-disabled="mostrarBtValidar===true" tabindex="18"/>
                    </md-input-container>
                    <br>
                    <div class="centrado-QR">
                        <qr ng-init="qrCodeVisible=valorQr" text="codigoQr" version="3" error-correction-level="Q" size="100" ng-show="qrCodeVisible"></qr>
                    </div>   
                </div> 
                <!--Imagen-->  
                <div layout="row" class="contImg">           
                    <img ng-src="data:image/jpeg;base64,{{UserPhoto}}" id="photo-id" width="450" height="450"/>          
                </div>
            </div>
            <br>     
            <div class="contenedor-tecnologia">
                <md-dialog-content class="selecTec">
                    <div class="md-dialog-content">
                        <form ng-submit="$event.preventDefault()">
                            <label class="txtSimilarMD">Tecnología</label>
                            <md-autocomplete pattern="[a-zA-Z]+"
                                md-selected-item="ctrl.selectedItemt"
                                md-search-text="ctrl.searchTextt"
                                md-items="item2 in ctrl.querySearchT(ctrl.searchTextt) | filter : tecnologia | limitTo : 4"
                                md-selected-item-change="ctrl.selectedItemChangeT(item2)"
                                md-item-text="item2.display"
                                md-min-length="2"
                                ng-model="referencia.tecnologia"
                                name="tecnologia"
                                ng-disabled="habilitarForm===true"
                                placeholder="Busque Tecnologías"
                                ng-required
                                ng-init="ctrl.searchTextt=tecnologiaCargada"
                                tabindex="19">
                            <md-item-template>
                                <span md-highlight-text="ctrl.searchTextt" md-highlight-flags="^i">{{item2.display}}</span>
                            </md-item-template>
                            <md-not-found>
                                No se encuenta "{{ctrl.searchTextt}}" en la lista.
                            </md-not-found>            
                            </md-autocomplete>
                      </form>
                    </div>
                    <div ng-messages ="useForm.tecnologia.$valid">         
                         <div ng-message="required"> * </div>
                    </div> 
                </md-dialog-content>
            </div>
                <p id="mensajeEstado"> {{mensajeEstado}}</p>
           
            
            <div class="botonesCrear" layout-align="center">
          
             <!-- BOTONES ROL ADMINISTRADOR/MANTENIMIENTO -->
                <md-button ng-show="mostrarBtCrear" class=botonesApp type="button"  ng-click="crearReferencia('borrador')" tabindex="19">Guardar (Borrador)</md-button>
                <md-button ng-disabled="useForm.$invalid" ng-show="mostrarBtCrear" class=botonesApp type="button"  ng-click="crearReferencia('pendiente')" tabindex="20">Terminar</md-button>
            <!-- BOTONES ROL VALIDADOR -->
                <md-button ng-show="mostrarBtValidar" class=botonesApp type="button"  ng-click="rechazarReferencia()" tabindex="21">Rechazar</md-button>
                <md-button ng-show="mostrarBtValidar" class=botonesApp type="button"  ng-click="validarReferencia()" tabindex="22">Validar</md-button>
               
            </div> 
        </div>
    </md-content>
</form>
